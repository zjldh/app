<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8" />
		<title></title>
		<link rel="stylesheet" href="./css/element.css">
		<link rel="stylesheet" href="./css/index.css">
		<script src="./js/vue.js"></script>
		<script src="./js/element.js"></script>

		<!--	<script src="https://getfirebug.com/firebug-lite.js#overrideConsole"></script>-->
	</head>

	<body>

		<div id="header">
			<el-row>
				<el-col :span="22">
					<div class="title" onmousedown="external.hitCaption()">工具</div>
				</el-col>
				<el-col :span="2">
					<div class="ctrl">
						<a class="el-icon-close" onclick="external.close()"></a>
					</div>
				</el-col>

			</el-row>
		</div>
		<div id="app">
			<el-button :disabled="isStart" size="mini" type="primary" @click="getConfig">开始</el-button>
			<el-button size="mini" @click="getConfig">测试</el-button>
			<el-tabs value="first">
				<el-tab-pane label="Hosts" name="first">
					<div class="info mb-20 fs-10"><i class="el-icon-tickets"></i> 配置hosts文件内容</div>
					<el-input disabled class="mb-10" v-model="hostPath">
						<template slot="prepend">
							<div width="380px">Host文件：</div>
						</template>
						<template slot="append">
							<el-button type="primary" onClick="aardioCall('hostPathChange')" icon="el-icon-edit"></el-button>
							<el-button type="primary" onClick="aardioCall('hostPathOpen')" icon="el-icon-folder-opened"></el-button>
						</template>
					</el-input>
					<el-input class="mb-10" v-model="host">
						<template slot="prepend">配置：</template>
						<template slot="append">
							<el-button type="primary" @click="hostAdd">添加</el-button>
						</template>
					</el-input>
					<el-table style="width: 100%" height="200px" 
						:data="hostList.filter(data => !hostKeyword || data.host.toLowerCase().includes(hostKeyword.toLowerCase()))">
						<el-table-column prop="$index" label="序号" width="60">
							<template slot="header" slot-scope="scope">
								序号<br/>
								<b class="danger">{{hostList.length}}</b>
							</template>
							<template slot-scope="scope">{{scope.$index+1}}</template>
						</el-table-column>
						<el-table-column prop="host" label="配置项" width="480">
						</el-table-column>

						<el-table-column prop="enabled" label="操作">
							<template slot="header" slot-scope="scope">
								<el-input v-model="hostKeyword" size="mini" placeholder="输入关键字搜索" />
							</template>
							<template slot-scope="scope">
								<span v-if="scope.row.edit">
									<el-button @click="hostPreEdit(scope.row.index,false)" size="mini" type="text">取消</el-button>
									<el-button @click="hostPreEdit(scope.row.index,true)" size="mini" type="text" icon="el-icon-save"></el-button>
								</span>
								<span v-else>
									<el-button @click="hostPreEdit(scope.row.index,true)" size="mini" type="text">编辑</el-button>
									<el-button @click="hostDelete(scope.row.index)" size="mini" type="text">删除</el-button>
									<el-button @click="hostSwitch(scope.row.index)" size="mini" type="text">{{scope.row.enabled ? '停用' : '启用'}}</el-button>
								</span>
							
							
								
							</template>
						</el-table-column>
					</el-table>
				</el-tab-pane>
				<el-tab-pane label="Proxy" name="second">
					<div class="info mb-20 fs-10"><i class="el-icon-tickets"></i> 配置监听端口</div>
					<el-table :data="proxyList" style="width: 100%" max-height="300">
						<el-table-column prop="$index" label="序号" width="60">
							<template slot-scope="scope">{{scope.$index+1}}</template>
						</el-table-column>
						<el-table-column prop="from" label="From" width="180">
						</el-table-column>
						<el-table-column prop="to" label="To" width="180">
						</el-table-column>
						<el-table-column prop="url" label="操作">
							<template slot-scope="scope">
								123{{scope.$index+1}}
								<span v-if="scope.row.edit">
									<el-button @click="hostPreEdit(scope.row.index,false)" size="mini" type="text">取消</el-button>
									<el-button @click="hostPreEdit(scope.row.index,true)" size="mini" type="text" icon="el-icon-save"></el-button>
								</span>
								<span v-else>
									<el-button @click="hostPreEdit(scope.row.index,true)" size="mini" type="text">编辑</el-button>
									<el-button @click="hostDelete(scope.row.index)" size="mini" type="text">删除 {{scope.$index}}</el-button>
									<el-button @click="hostSwitch(scope.row.index)" size="mini" type="text">{{scope.row.enabled ? '停用' : '启用'}}</el-button>
								</span>
							</template>
						</el-table-column>
					</el-table>
				</el-tab-pane>
			</el-tabs>

			<div style="max-height: 40px;">
				{{count}} : {{json}}
			</div>
		</div>

	</body>
	<script>
		var header = new Vue({
			el: "#header"
		})
		var REG_HOST = /^(\d{1,3}\.){3}\d{1,3}\s+[\w\.\-]{4,}$/
		var app = new Vue({
			el: "#app",
			data: {
				hostPath: "",
				host: "",
				isStart: false,
				json: "123",
				count: 0,
				proxyList: [{
					
				}],
				hostList: [{
					host: "127.0.0.1 aaa.com",
					enabled: true
				},{host: "127.0.0.1 aaa.com",enabled: true},
				{host: "127.0.0.1 aaa.com",enabled: true},
				{host: "127.0.0.1 aaa.com",enabled: true},
				{host: "127.0.0.1 aaa.com",enabled: true},
				{host: "127.0.0.1 aaa.com",enabled: true},
				{host: "127.0.0.1 aaa.com",enabled: true},
				{host: "127.0.0.1 aaa.com",enabled: true},
				{host: "127.0.0.1 aaa.com",enabled: true},
				{host: "127.0.0.1 aaa.com",enabled: true},
				{host: "127.0.0.1 aaa.com",enabled: true},
				{host: "127.0.0.1 aaa.com",enabled: true},
				{host: "127.0.0.1 aaa.com",enabled: true},
				{host: "127.0.0.1 aaa.com",enabled: true},
				{host: "127.0.0.1 aaa.com",enabled: true}
				],
				hostKeyword:''
			},
			methods: {
				click: function() {
					this.isStart = !this.isStart;
					aardioCall("start");
				},
				test: function() {
					onMsg("success", "123")
				},
				getConfig: function() {
					aardioCall("getConfig")
				},
				tableRowClassName(scope){
					console.log("xx")
					return scope.row.enabled ? 'success-row' :'';
				},
				hostAdd() {
					var host = this.host && this.host.trim();
					if (host && REG_HOST.test(host)) {
						aardioCall("hostAdd", host)
						//onMsg("success","添加成功");
						this.host = "";
					} else {
						onMsg("warn", "配置不合法，（ip  域名）")
					}
				},
				hostDelete(index) {
					aardioCall("hostDelete",index);
				},
				hostPreEdit(index,isEdit) {
					this.hostList[index-1].edit = isEdit
				},
				hostSwitch(index) {
					aardioCall("hostSwitch",index);
				},


			}
		})

		var aardioCall = function(method, args) {
			return external[method](args)
		}

		function onDataChange(rlt) {
			var data = rlt.data;
			app.json = JSON.stringify(rlt.data)
			app.count++;
			app.hostPath = data.hostPath;
			var hostList = []
			alert(data.hostList.length)
			for(var i=0,len=data.hostList.length; i<len;i++){
				var item = data.hostList[i]
				if(data.hostList[i]){
					item.index=i+1;
					hostList.push(item)
				}
				
			}
			app.hostList = hostList;
			return;
			switch (rlt.type) {
				case 'config':
					onMsg('success', rlt.data)
					updateConfig(rlt.data);
					//onMsg("warn",app.hostPath)
				case 'table':
					app.tableData = rlt.data;
					break;
				default:

			}

		}

		function updateConfig(config) {
			for (var k in config) {
				alert(k);
				app[k] = config[k]
			}
		}
		var msgTypeName = {
			"success": "成功",
			"warn": "警告",
			"error": "错误"
		}

		function onMsg(type, msg) {
			app.$notify({
				title: msgTypeName[type],
				message: msg,
				type: type
			});
		}
	</script>

</html>
